<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1490" height="1182" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant Alice
participant Server
participant Bob

Server->Server: Choose long-term secret key R
Server->Server: Calculate long-term public key g^R

Bob->Bob: Choose long-term secret key I
Bob->Bob: Calculate long-term public key g^I

Bob->Bob: Generate prekey message
Bob->Bob: Create user profile

Note over Server,Bob: These steps above can be done long time before DAKEZ

Bob->Bob: Create prekey messages

Note over Server,Bob: DAKEZ starts

Bob->Bob: Select ephemeral secret key i in q
Bob->Bob: Calculate ephemeral public key g^i
Bob->Server: Send "I", g^i

Server->Server: Select ephemeral secret key r in q
Server->Server: Calculate ephemeral public key g^r
Server->Server: Compute t = "0" || "I" || "R" || g^i || g^r || phi
Server->Bob: Send "R", g^r, RSig(g^R, R, {g^I, g^R, g^i}, t)
Server->Server: Compute k = KDF((g^i)^r)
Server->Server: Securely erase r

Bob->Bob: Verify proof sent by Server
Bob->Bob: Compute t = "1" || "I" || "R" || g^i || g^r || phi
Bob->Server: Send RSig(g^I, I, {g^I, g^R, g^r}, t)
Bob->Bob: Compute k = KDF((g^r)^i)

Server->Server: Verify proof sent by Bob

Note over Server,Bob: DAKEZ ends

Bob->Server: Encrypts prekey message and publish

Alice->Server: Retrieve Bob's prekey message
]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="70" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="20">Alice</tspan></text></g><g class="actor"><rect x="10" y="1123" width="70" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="1148" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="20">Alice</tspan></text></g><line x1="45" x2="45" y1="59" y2="1123" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="315" y="20" width="80" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="325" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="325">Server</tspan></text></g><g class="actor"><rect x="315" y="1123" width="80" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="325" y="1148" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="325">Server</tspan></text></g><line x1="355" x2="355" y1="59" y2="1123" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="870" y="20" width="50" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="880" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="880">Bob</tspan></text></g><g class="actor"><rect x="870" y="1123" width="50" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="880" y="1148" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="880">Bob</tspan></text></g><line x1="895" x2="895" y1="59" y2="1123" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="380" y="93.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Choose long-term secret key R</tspan></text><line x1="355" x2="375" y1="79" y2="79" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="79" y2="103" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="103" y2="103" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="132.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Calculate long-term public key g^R</tspan></text><line x1="355" x2="375" y1="118" y2="118" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="118" y2="142" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="142" y2="142" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="171.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Choose long-term secret key I</tspan></text><line x1="895" x2="915" y1="157" y2="157" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="157" y2="181" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="181" y2="181" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="210.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Calculate long-term public key g^I</tspan></text><line x1="895" x2="915" y1="196" y2="196" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="196" y2="220" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="220" y2="220" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="249.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Generate prekey message</tspan></text><line x1="895" x2="915" y1="235" y2="235" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="235" y2="259" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="259" y2="259" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="288.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Create user profile</tspan></text><line x1="895" x2="915" y1="274" y2="274" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="274" y2="298" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="298" y2="298" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="313" width="560" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="333" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">These steps above can be done long time before DAKEZ</tspan></text></g><g class="signal"><text x="920" y="376.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Create prekey messages</tspan></text><line x1="895" x2="915" y1="362" y2="362" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="362" y2="386" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="386" y2="386" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="401" width="560" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="421" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">DAKEZ starts</tspan></text></g><g class="signal"><text x="920" y="464.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Select ephemeral secret key i in q</tspan></text><line x1="895" x2="915" y1="450" y2="450" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="450" y2="474" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="474" y2="474" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="503.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Calculate ephemeral public key g^i</tspan></text><line x1="895" x2="915" y1="489" y2="489" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="489" y2="513" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="513" y2="513" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="560" y="538.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="560">Send "I", g^i</tspan></text><line x1="895" x2="355" y1="547" y2="547" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="581.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Select ephemeral secret key r in q</tspan></text><line x1="355" x2="375" y1="567" y2="567" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="567" y2="591" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="591" y2="591" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="620.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Calculate ephemeral public key g^r</tspan></text><line x1="355" x2="375" y1="606" y2="606" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="606" y2="630" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="630" y2="630" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="659.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Compute t = "0" || "I" || "R" || g^i || g^r || phi</tspan></text><line x1="355" x2="375" y1="645" y2="645" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="645" y2="669" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="669" y2="669" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="390" y="694.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="390">Send "R", g^r, RSig(g^R, R, {g^I, g^R, g^i}, t)</tspan></text><line x1="355" x2="895" y1="703" y2="703" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="737.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Compute k = KDF((g^i)^r)</tspan></text><line x1="355" x2="375" y1="723" y2="723" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="723" y2="747" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="747" y2="747" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="776.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Securely erase r</tspan></text><line x1="355" x2="375" y1="762" y2="762" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="762" y2="786" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="786" y2="786" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="815.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Verify proof sent by Server</tspan></text><line x1="895" x2="915" y1="801" y2="801" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="801" y2="825" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="825" y2="825" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="854.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Compute t = "1" || "I" || "R" || g^i || g^r || phi</tspan></text><line x1="895" x2="915" y1="840" y2="840" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="840" y2="864" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="864" y2="864" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="440" y="889.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="440">Send RSig(g^I, I, {g^I, g^R, g^r}, t)</tspan></text><line x1="895" x2="355" y1="898" y2="898" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="920" y="932.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="920">Compute k = KDF((g^r)^i)</tspan></text><line x1="895" x2="915" y1="918" y2="918" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="915" y1="918" y2="942" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="915" x2="895" y1="942" y2="942" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="971.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Verify proof sent by Bob</tspan></text><line x1="355" x2="375" y1="957" y2="957" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="957" y2="981" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="981" y2="981" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="996" width="560" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="1016" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">DAKEZ ends</tspan></text></g><g class="signal"><text x="450" y="1055.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="450">Encrypts prekey message and publish</tspan></text><line x1="895" x2="355" y1="1064" y2="1064" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="55" y="1094.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="55">Retrieve Bob's prekey message</tspan></text><line x1="45" x2="355" y1="1103" y2="1103" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g></svg>