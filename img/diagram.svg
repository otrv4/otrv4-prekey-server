<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="2030" height="1133" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant Alice
participant Server
participant Bob

Bob->Bob: Generate prekey message

Note over Server,Bob: DAKEZ starts

Bob->Bob: Choose long-term sercret key I
Bob->Bob: Calculate long-term public key g^I
Bob->Bob: Select ephemeral secrets i in Zq
Bob->Bob: Generate PQ-I and SQ-I using QRGen-I()
Bob->Server: Send "I", g^i, PQ-I

Server->Server: Choose long-term sercret key R
Server->Server: Calculate long-term public key g^R

Server->Server: Select ephemeral secrets r in Zq
Server->Server: Generate Q-k and Q-k using QRGen-I(PQ-I)
Server->Server: Compute t = "0" || "I" || "R" || g^i || g^r || PQ-I || Q-r || associated data
Server->Bob: Send "R", g^r, Q-r, RSig(g^R, R, {g^I, g^R, g^i}, t)
Server->Server: Compute k = KDF((g^i)^r || Q-k)
Server->Server: Securely erase r and Q-k

Bob->Bob: Verify proof sent by Server
Bob->Bob: Compute t = "1" || "I" || "R" || g^i || g^r || PQ-I || Q-r || associated data
Bob->Server: Send RSig(g^I, I, {g^I, g^R, g^r}, t)
Bob->Bob: Q-k = QRKey-I(SQ-I, Q-R)
Bob->Bob: Compute k = KDF((g^r)^i || Q-k)

Server->Server: Verify proof sent by Bob

Note over Server,Bob: DAKEZ ends

Bob->Server: Publish prekey message
Server->Server: Validate Bob's user profile

Alice->Server: Retrieve Bob's prekey message]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="70" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="20">Alice</tspan></text></g><g class="actor"><rect x="10" y="1074" width="70" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="1099" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="20">Alice</tspan></text></g><line x1="45" x2="45" y1="59" y2="1074" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="315" y="20" width="80" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="325" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="325">Server</tspan></text></g><g class="actor"><rect x="315" y="1074" width="80" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="325" y="1099" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="325">Server</tspan></text></g><line x1="355" x2="355" y1="59" y2="1074" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="1140" y="20" width="50" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="1150" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1150">Bob</tspan></text></g><g class="actor"><rect x="1140" y="1074" width="50" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="1150" y="1099" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1150">Bob</tspan></text></g><line x1="1165" x2="1165" y1="59" y2="1074" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="1190" y="93.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Generate prekey message</tspan></text><line x1="1165" x2="1185" y1="79" y2="79" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="79" y2="103" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="103" y2="103" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="118" width="830" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="138" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">DAKEZ starts</tspan></text></g><g class="signal"><text x="1190" y="181.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Choose long-term sercret key I</tspan></text><line x1="1165" x2="1185" y1="167" y2="167" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="167" y2="191" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="191" y2="191" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="220.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Calculate long-term public key g^I</tspan></text><line x1="1165" x2="1185" y1="206" y2="206" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="206" y2="230" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="230" y2="230" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="259.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Select ephemeral secrets i in Zq</tspan></text><line x1="1165" x2="1185" y1="245" y2="245" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="245" y2="269" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="269" y2="269" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="298.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Generate PQ-I and SQ-I using QRGen-I()</tspan></text><line x1="1165" x2="1185" y1="284" y2="284" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="284" y2="308" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="308" y2="308" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="665" y="333.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="665">Send "I", g^i, PQ-I</tspan></text><line x1="1165" x2="355" y1="342" y2="342" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="376.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Choose long-term sercret key R</tspan></text><line x1="355" x2="375" y1="362" y2="362" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="362" y2="386" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="386" y2="386" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="415.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Calculate long-term public key g^R</tspan></text><line x1="355" x2="375" y1="401" y2="401" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="401" y2="425" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="425" y2="425" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="454.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Select ephemeral secrets r in Zq</tspan></text><line x1="355" x2="375" y1="440" y2="440" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="440" y2="464" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="464" y2="464" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="493.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Generate Q-k and Q-k using QRGen-I(PQ-I)</tspan></text><line x1="355" x2="375" y1="479" y2="479" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="479" y2="503" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="503" y2="503" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="532.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Compute t = "0" || "I" || "R" || g^i || g^r || PQ-I || Q-r || associated data</tspan></text><line x1="355" x2="375" y1="518" y2="518" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="518" y2="542" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="542" y2="542" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="500" y="567.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="500">Send "R", g^r, Q-r, RSig(g^R, R, {g^I, g^R, g^i}, t)</tspan></text><line x1="355" x2="1165" y1="576" y2="576" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="610.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Compute k = KDF((g^i)^r || Q-k)</tspan></text><line x1="355" x2="375" y1="596" y2="596" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="596" y2="620" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="620" y2="620" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="649.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Securely erase r and Q-k</tspan></text><line x1="355" x2="375" y1="635" y2="635" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="635" y2="659" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="659" y2="659" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="688.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Verify proof sent by Server</tspan></text><line x1="1165" x2="1185" y1="674" y2="674" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="674" y2="698" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="698" y2="698" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="727.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Compute t = "1" || "I" || "R" || g^i || g^r || PQ-I || Q-r || associated data</tspan></text><line x1="1165" x2="1185" y1="713" y2="713" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="713" y2="737" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="737" y2="737" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="575" y="762.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="575">Send RSig(g^I, I, {g^I, g^R, g^r}, t)</tspan></text><line x1="1165" x2="355" y1="771" y2="771" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="805.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Q-k = QRKey-I(SQ-I, Q-R)</tspan></text><line x1="1165" x2="1185" y1="791" y2="791" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="791" y2="815" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="815" y2="815" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1190" y="844.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1190">Compute k = KDF((g^r)^i || Q-k)</tspan></text><line x1="1165" x2="1185" y1="830" y2="830" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1185" y1="830" y2="854" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1185" x2="1165" y1="854" y2="854" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="883.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Verify proof sent by Bob</tspan></text><line x1="355" x2="375" y1="869" y2="869" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="869" y2="893" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="893" y2="893" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="908" width="830" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="928" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">DAKEZ ends</tspan></text></g><g class="signal"><text x="650" y="967.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="650">Publish prekey message</tspan></text><line x1="1165" x2="355" y1="976" y2="976" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="1010.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Validate Bob's user profile</tspan></text><line x1="355" x2="375" y1="996" y2="996" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="996" y2="1020" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="1020" y2="1020" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="55" y="1045.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="55">Retrieve Bob's prekey message</tspan></text><line x1="45" x2="355" y1="1054" y2="1054" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g></svg>