<?xml version="1.0" encoding="utf-8" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"><svg xmlns="http://www.w3.org/2000/svg" width="1790" height="1172" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[participant Alice
participant Server
participant Bob

Bob->Bob: Generate prekey message

Bob->Bob: Choose long-term sercret key I
Bob->Bob: Calculate long-term public key g^I

Server->Server: Choose long-term sercret key R
Server->Server: Calculate long-term public key g^R

Note over Server,Bob: DAKEZ starts

Bob->Bob: Select ephemeral secrets i in q
Bob->Bob: Calculate ephemeral public key g^i
Bob->Bob: Generate PQ-I and SQ-I using QRGen-I()
Bob->Server: Send "I", g^i, PQ-I

Server->Server: Select ephemeral secrets r in q
Server->Server: Generate Q-k and Q-k using QRGen-I(PQ-I)
Server->Server: Compute t = "0" || "I" || "R" || g^i || g^r || PQ-I || Q-r || phi
Server->Bob: Send "R", g^r, Q-r, RSig(g^R, R, {g^I, g^R, g^i}, t)
Server->Server: Compute k = KDF((g^i)^r || Q-k)
Server->Server: Securely erase r and Q-k

Bob->Bob: Verify proof sent by Server
Bob->Bob: Compute t = "1" || "I" || "R" || g^i || g^r || PQ-I || Q-r || phi
Bob->Server: Send RSig(g^I, I, {g^I, g^R, g^r}, t)
Bob->Bob: Q-k = QRKey-I(SQ-I, Q-R)
Bob->Bob: Compute k = KDF((g^r)^i || Q-k)

Server->Server: Verify proof sent by Bob

Note over Server,Bob: DAKEZ ends

Bob->Server: Publish prekey message
Server->Server: Validate Bob's user profile

Alice->Server: Retrieve Bob's prekey message]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.92,16 0,13.7 5.76,8 0,2.286 1.92,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="70" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="20">Alice</tspan></text></g><g class="actor"><rect x="10" y="1113" width="70" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="20" y="1138" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="20">Alice</tspan></text></g><line x1="45" x2="45" y1="59" y2="1113" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="315" y="20" width="80" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="325" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="325">Server</tspan></text></g><g class="actor"><rect x="315" y="1113" width="80" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="325" y="1138" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="325">Server</tspan></text></g><line x1="355" x2="355" y1="59" y2="1113" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="1020" y="20" width="50" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="1030" y="45" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1030">Bob</tspan></text></g><g class="actor"><rect x="1020" y="1113" width="50" height="39" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="1030" y="1138" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1030">Bob</tspan></text></g><line x1="1045" x2="1045" y1="59" y2="1113" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="1070" y="93.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Generate prekey message</tspan></text><line x1="1045" x2="1065" y1="79" y2="79" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="79" y2="103" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="103" y2="103" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="132.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Choose long-term sercret key I</tspan></text><line x1="1045" x2="1065" y1="118" y2="118" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="118" y2="142" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="142" y2="142" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="171.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Calculate long-term public key g^I</tspan></text><line x1="1045" x2="1065" y1="157" y2="157" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="157" y2="181" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="181" y2="181" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="210.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Choose long-term sercret key R</tspan></text><line x1="355" x2="375" y1="196" y2="196" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="196" y2="220" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="220" y2="220" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="249.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Calculate long-term public key g^R</tspan></text><line x1="355" x2="375" y1="235" y2="235" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="235" y2="259" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="259" y2="259" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="274" width="710" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="294" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">DAKEZ starts</tspan></text></g><g class="signal"><text x="1070" y="337.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Select ephemeral secrets i in q</tspan></text><line x1="1045" x2="1065" y1="323" y2="323" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="323" y2="347" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="347" y2="347" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="376.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Calculate ephemeral public key g^i</tspan></text><line x1="1045" x2="1065" y1="362" y2="362" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="362" y2="386" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="386" y2="386" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="415.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Generate PQ-I and SQ-I using QRGen-I()</tspan></text><line x1="1045" x2="1065" y1="401" y2="401" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="401" y2="425" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="425" y2="425" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="605" y="450.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="605">Send "I", g^i, PQ-I</tspan></text><line x1="1045" x2="355" y1="459" y2="459" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="493.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Select ephemeral secrets r in q</tspan></text><line x1="355" x2="375" y1="479" y2="479" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="479" y2="503" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="503" y2="503" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="532.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Generate Q-k and Q-k using QRGen-I(PQ-I)</tspan></text><line x1="355" x2="375" y1="518" y2="518" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="518" y2="542" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="542" y2="542" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="571.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Compute t = "0" || "I" || "R" || g^i || g^r || PQ-I || Q-r || phi</tspan></text><line x1="355" x2="375" y1="557" y2="557" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="557" y2="581" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="581" y2="581" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="440" y="606.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="440">Send "R", g^r, Q-r, RSig(g^R, R, {g^I, g^R, g^i}, t)</tspan></text><line x1="355" x2="1045" y1="615" y2="615" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="649.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Compute k = KDF((g^i)^r || Q-k)</tspan></text><line x1="355" x2="375" y1="635" y2="635" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="635" y2="659" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="659" y2="659" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="688.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Securely erase r and Q-k</tspan></text><line x1="355" x2="375" y1="674" y2="674" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="674" y2="698" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="698" y2="698" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="727.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Verify proof sent by Server</tspan></text><line x1="1045" x2="1065" y1="713" y2="713" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="713" y2="737" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="737" y2="737" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="766.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Compute t = "1" || "I" || "R" || g^i || g^r || PQ-I || Q-r || phi</tspan></text><line x1="1045" x2="1065" y1="752" y2="752" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="752" y2="776" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="776" y2="776" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="515" y="801.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="515">Send RSig(g^I, I, {g^I, g^R, g^r}, t)</tspan></text><line x1="1045" x2="355" y1="810" y2="810" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="844.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Q-k = QRKey-I(SQ-I, Q-R)</tspan></text><line x1="1045" x2="1065" y1="830" y2="830" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="830" y2="854" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="854" y2="854" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="1070" y="883.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="1070">Compute k = KDF((g^r)^i || Q-k)</tspan></text><line x1="1045" x2="1065" y1="869" y2="869" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1065" y1="869" y2="893" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="1065" x2="1045" y1="893" y2="893" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="922.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Verify proof sent by Bob</tspan></text><line x1="355" x2="375" y1="908" y2="908" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="908" y2="932" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="932" y2="932" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="note"><rect x="345" y="947" width="710" height="29" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="350" y="967" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="350">DAKEZ ends</tspan></text></g><g class="signal"><text x="590" y="1006.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="590">Publish prekey message</tspan></text><line x1="1045" x2="355" y1="1015" y2="1015" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="380" y="1049.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="380">Validate Bob's user profile</tspan></text><line x1="355" x2="375" y1="1035" y2="1035" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="375" y1="1035" y2="1059" style="stroke-width: 2;" stroke="#000000" fill="none"></line><line x1="375" x2="355" y1="1059" y2="1059" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="55" y="1084.5" style="font-size: 16px; font-family: Andale\ Mono, monospace;"><tspan x="55">Retrieve Bob's prekey message</tspan></text><line x1="45" x2="355" y1="1093" y2="1093" style="stroke-width: 2; marker-end: url(&quot;#markerArrowBlock&quot;);" stroke="#000000" fill="none"></line></g></svg>